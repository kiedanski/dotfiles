#!/usr/bin/env bash


OPTIONS=$(cat <<- END
	1. Single Screen
	2. Dual Screen
END
)

get_connected_external_displays() {
  xrandr | grep " connected" | grep -v "eDP-1" | awk '{ print $1 }'
}

# Get connected external displays
CONNECTED_EXTERNAL_DISPLAYS=$(get_connected_external_displays)

# Determine which DP output to use
if echo "$CONNECTED_EXTERNAL_DISPLAYS" | grep -q "DP-1"; then
  DP_OUTPUT="DP-1"
elif echo "$CONNECTED_EXTERNAL_DISPLAYS" | grep -q "DP-2"; then
  DP_OUTPUT="DP-2"
else
  echo "No external display connected."
  DP_OUTPUT=""
fi

function multi_display {

  killall -q polybar
  xrandr --output eDP-1 --primary --mode 2048x1152 --auto --output $DP_OUTPUT --auto --right-of eDP-1
  bspc monitor eDP-1 -d I II III IV
  bspc monitor $DP_OUTPUT -d V VI VII VIII
  
  echo "---" | tee -a /tmp/polybar_primary.log /tmp/polybar_secondary.log
  polybar -c $HOME/.config/polybar/primary.ini 2>&1 | tee -a /tmp/polybar_primary.log & disown
  polybar -c $HOME/.config/polybar/secondary.ini 2>&1 | tee -a /tmp/polybar_secondary.log & disown

}

function single_display {

  killall -q polybar
  xrandr --output eDP-1 --primary --mode 2048x1152 --auto
  xrandr --output $DP_OUTPUT --off
  bspc monitor eDP-1 -d I II III IV V VI VII VIII

  echo "---" | tee -a /tmp/polybar_config.log
  polybar -c $HOME/.config/polybar/config.ini 2>&1 | tee -a /tmp/polybar_config.log & disown

}

echo "$1"
if [[ $# -eq 0 ]]; then
	echo "Entre"
	SELECTION=$(echo "$OPTIONS" | rofi -dmenu)
else
	SELECTION="$1"
fi

echo "$SELECTION"

case $SELECTION in 
	1*) single_display;;
	2*) multi_display;;
	* ) echo "Invalid Option";;
esac
